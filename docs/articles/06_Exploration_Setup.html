<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploration • compbio2020</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Exploration">
<meta property="og:description" content="compbio2020">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">compbio2020</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00_Syllabus_and_Expectations.html">Syllabus</a>
    </li>
    <li>
      <a href="../articles/01_Getting_Started_with_R.html">Starting with R</a>
    </li>
    <li>
      <a href="../articles/02_Starting_with_Data.html">Starting with data</a>
    </li>
    <li>
      <a href="../articles/03_Manipulating_Data.html">Manipulating, analyzing and exporting data with tidyverse</a>
    </li>
    <li>
      <a href="../articles/04-plotting.html">Data visualization with ggplot2</a>
    </li>
    <li>
      <a href="../articles/05_Functions.html">Functions and repeatability</a>
    </li>
    <li>
      <a href="../articles/06_Exploration_Setup.html">Exploration</a>
    </li>
    <li>
      <a href="../articles/08_linear_models.html">Introduction to Linear Models: Building and Interpreting Linear Regressions</a>
    </li>
    <li>
      <a href="../articles/09_Tree_of_life.html">GeneticData</a>
    </li>
    <li>
      <a href="../articles/10_GBIF_and_Location.html">GBIF And Spatial Data</a>
    </li>
    <li>
      <a href="../articles/HomeworkFive.html">Homework Five</a>
    </li>
    <li>
      <a href="../articles/HomeworkFour.html">HomeworkFour</a>
    </li>
    <li>
      <a href="../articles/HomeworkThree.html">Homework Three</a>
    </li>
    <li>
      <a href="../articles/HomeworkTwo.html">Homework Two</a>
    </li>
    <li>
      <a href="../articles/ProjectOne.html">ProjectOne</a>
    </li>
    <li>
      <a href="../articles/ProjectTwo.html">Project Two</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="06_Exploration_Setup_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploration</h1>
                        <h4 class="author">April Wright</h4>
            
      
      
      <div class="hidden name"><code>06_Exploration_Setup.Rmd</code></div>

    </div>

    
    
<p>Today, we’re going to do something a little different than we have been doing.</p>
<p>What we’re going to be doing is learning how to link together different datasets with common data columns. We’re going to begin by linking specimen occurrences, from a website called GBIF, to temperature occurrences from NOAA.</p>
<div id="rnoaa" class="section level1">
<h1 class="hasAnchor">
<a href="#rnoaa" class="anchor"></a>rNOAA</h1>
<p>We are going to get some climate data from NOAA and we’ll be downloading animal occurrence data from a database called GBIF.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rnoaa"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rgbif"</span><span class="op">)</span></pre></div>
<p>Next, we will get an API key for accessing government data. Go to <a href="https://www.ncdc.noaa.gov/cdo-web/token">this</a> website to obtain one. We will save this key in a file called <code>.rprofile</code>. API keys are basically like passwords between ourselves and a website. They enable us to access data securely. We will do this step first because sometimes getting the key emailed to you takes a moment.</p>
<p>We’re going to start with the animal data. So far in this class, we have been working with a dataset with all the animal names written out in a spreadsheet. In the wider world, however, there are tons of animals. Some have the same genus name. Some have the same species name. Some have the same binomial as a plant. Lovely stuff! And so, many databases implement a way to <em>globalize</em> names. Here, we are locating the unique key which connects to <em>Procyon lotor</em>, the common raccoon.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif">rgbif</a></span><span class="op">)</span>
<span class="va">key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html">name_suggest</a></span><span class="op">(</span>q<span class="op">=</span><span class="st">'Procyon lotor'</span>, rank<span class="op">=</span><span class="st">'species'</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">key</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></pre></div>
<p>Once we have done this, we are able to use the key to query the database for records pertaining to the raccoon. To do this, we are only going to take 100 records to keep the data manageable.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html">occ_search</a></span><span class="op">(</span>taxonKey<span class="op">=</span><span class="va">key</span>, limit<span class="op">=</span><span class="fl">500</span><span class="op">)</span>

<span class="va">res</span></pre></div>
<p>First, look at the data visually. Do we have the amount of observations and columns we should? We should have 220 columns. Try confirming this with the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> command.</p>
<p>Hoo-boy, this is an odd object. Use dollar sign indexing (<code>res$</code>) to look at some of these objects. See if you can find a way to assign the actual data table to a new object.</p>
<p>We are going to be particularly interested in the scientificName, decimalLatitude, and decimal Longitude columns. Create a new dataset containing only these three columns. We’re going to take a quick look at a map of these data, just to get a feel for where these raccoons are. We’ll install a package called <code>leaflet</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"leaflet"</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span>
<span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="va">small_data</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addMarkers</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span>, popup <span class="op">=</span> <span class="va">small_data</span><span class="op">$</span><span class="va">scientificName</span><span class="op">)</span></pre></div>
<p>We can see that these data come from all over. Next, we will try to query some temperature data for these observations. NOAA can be a little tricky to work with. So the first thing we will do is download some information on weather stations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu">rnoaa</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnoaa/reference/ghcnd_stations.html">ghcnd_stations</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p>Look carefully at the GBIF data, and then the NOAA data. Are the column names for latitude and longitude the same? Are they recorded to the same precision? If no, briefly correct these errors.</p>
<p>Next, we will try to join these data together. We can join in several ways. All follow the same fundmental syntax:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">joined</span> <span class="op">&lt;-</span> <span class="va">small_data</span> <span class="op">%&gt;%</span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">stats</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Take a look at this <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">reference</a>, and try a couple different joins. No matter what we do, we seem to end up with many more rows than we had. Why is this?</p>
<p>What we’ll do is remove duplicate coordinates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">id_taxon</span> <span class="op">&lt;-</span> <span class="va">joined</span> <span class="op">%&gt;%</span> 
 <span class="fu">distinct</span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">latitude</span>, <span class="va">longitude</span>,  .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<p>We can see we still have the <code>id</code> column, which may be used to query weather. Which we will do now. The <code>ghcnd_search</code> function in the RNOAA package allows us to search data by weather station, temperature type, and date. The syntax looks like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu">rnoaa</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnoaa/reference/ghcnd_search.html">ghcnd_search</a></span><span class="op">(</span>stationid<span class="op">=</span> <span class="st">"AR000087078"</span>, var <span class="op">=</span> <span class="st">"TAVG"</span>, date_min<span class="op">=</span><span class="st">"2021-10-01"</span>, date_max <span class="op">=</span> <span class="st">"2021-10-01"</span><span class="op">)</span></pre></div>
<p>How can we query a whole column of data? Let’s take a moment and think about it.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co">#We will fill this in during class</span></pre></div>
<p>You will notice two things: Firstly, that this is once again a list of objects. Secondly, you may notice that these temps look real, real odd. They are listed in tenths of a degree centigrade. We’ll convert the temperatures to Fahrenheit. Save this to your temp_data as column fahr.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="co">#Try it out here.</span></pre></div>
<p>Next, let’s take a look at these visually to see if this seems more normal.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu">ggplot</span><span class="op">(</span><span class="va">temp_join</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y<span class="op">=</span><span class="va">fahr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> </pre></div>
<p>And we fit a linear model to see if temperature was increasing with longitude:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">~</span><span class="va">fahr</span>, data<span class="op">=</span><span class="va">temp_join</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">temp_join</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y<span class="op">=</span><span class="va">fahr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span><span class="op">)</span></pre></div>
<p>Now, we’ll merge the two data sources. Have a look at the <code>merge</code> function. Try it.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co">#noaa_data &lt;- read_csv("data_output/noaa_data.csv")</span>
<span class="va">merged_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">stations</span> , <span class="va">small_data</span><span class="op">)</span></pre></div>
</div>
<div id="exploration-time" class="section level1">
<h1 class="hasAnchor">
<a href="#exploration-time" class="anchor"></a>Exploration time:</h1>
<p>Pick one weather station and see if you can query multiple max temperature observations over time. Try plotting max temp as a function of time. Or, try plotting a different temperature measurement. Or querying more data from GBIF, or a specific locaclity.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by April Wright.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
